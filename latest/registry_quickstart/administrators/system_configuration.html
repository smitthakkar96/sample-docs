<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>Atomic Registry Latest | Quickstart | Administrators | System Configuration</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='Project Atomic. Sponsored by Red Hat, Inc.' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='http://www.projectatomic.io/images/favicon.ico' rel='shortcut icon'>
<link href='http://www.projectatomic.io/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='http://www.projectatomic.io/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='http://www.projectatomic.io/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='http://www.projectatomic.io/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='http://www.projectatomic.io/blog/feed.xml' rel='alternate' title='Project Atomic' type='application/atom+xml'>
<link href="http://www.projectatomic.io/stylesheets/application.css" rel="stylesheet" type="text/css" />
<link href="http://www.projectatomic.io/stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' docs docs_introduction docs_introduction_index source-md'>
<section class='container' id='page-wrap'>
  <div class='row'>
  <div class='col-md-3 col-lg-2' id='sidebar'>
    <div id='nav-primary'>
      <nav class='navbar navbar-default' role='navigation'>
        <div class='navbar-header'>
          <button class='navbar-toggle' data-target='.navbar-ex1-collapse' data-toggle='collapse'>
            <span class='sr-only'>
              Toggle navigation
            </span>
            <span class='icon-bar'></span>
            <span class='icon-bar'></span>
            <span class='icon-bar'></span>
          </button>
          <a class='navbar-brand' href='http://www.projectatomic.io/'>
            Project Atomic
          </a>
        </div>
        <div class='collapse navbar-collapse navbar-ex1-collapse'>
          <ul class='nav navbar-nav'>
            <li><a class="get-started" href="http://www.projectatomic.io/download">Get Started</a></li>
            <li><a class="documentation" href="http://www.projectatomic.io/docs">Documentation</a></li>
            <li><a class="developer-community" href="http://www.projectatomic.io/community">Developer Community</a></li>
            <li><a class="on-github" href="https://github.com/projectatomic/">On GitHub</a></li>
            <li><a class="ask" href="http://ask.projectatomic.io/">Ask</a></li>
            <li><a class="blog" href="http://www.projectatomic.io/blog">Blog</a></li>
            <li><a class="twitter" href="http://www.twitter.com/projectatomic">Twitter</a></li>
            <li><a class="facebook" href="https://www.facebook.com/projectatomic">Facebook</a></li>
            <li><a class="google" href="https://plus.google.com/108727025270662383247/posts">Google+</a></li>
            <li><a class="rss" href="http://www.projectatomic.io/blog/feed.xml">RSS</a></li>
          </ul>
        </div>
      </nav>
    </div>
  </div>

<section class='col-lg-10 col-md-9 container-fluid' id='content'>
<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser.
<a href="http://browsehappy.com/">Upgrade your browser today</a> or
<a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->
<div class='row'>
  <div class='col-sm-9'>
    <h2>Getting Started with System Configuration for Administrators</h2>
    <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#explore-the-environment">Explore the Environment</a></li>
<li><a href="#logging">Logging</a></li>
<li><a href="#configuration">Configuration</a>
<ul class="sectlevel2">
<li><a href="#master-configuration">Master Configuration</a></li>
<li><a href="#registry-console-configuration">Registry Console Configuration</a></li>
<li><a href="#registry-configuration">Registry Configuration</a></li>
</ul>
</li>
<li><a href="#registry-configuration-reference">Registry Configuration Reference</a>
<ul class="sectlevel2">
<li><a href="#docker-registry-configuration-reference-log">Log</a></li>
<li><a href="#docker-registry-configuration-reference-hooks">Hooks</a></li>
<li><a href="#docker-registry-configuration-reference-storage">Storage</a></li>
<li><a href="#docker-registry-configuration-reference-auth">Auth</a></li>
<li><a href="#docker-registry-configuration-reference-middleware">Middleware</a></li>
<li><a href="#docker-registry-configuration-reference-openshift">OpenShift</a></li>
<li><a href="#docker-registry-configuration-reference-reporting">Reporting</a></li>
<li><a href="#docker-registry-configuration-reference-http">HTTP</a></li>
<li><a href="#docker-registry-configuration-reference-notifications">Notifications</a></li>
<li><a href="#docker-registry-configuration-reference-redis">Redis</a></li>
<li><a href="#docker-registry-configuration-reference-health">Health</a></li>
<li><a href="#docker-registry-configuration-reference-proxy">Proxy</a></li>
</ul>
</li>
<li><a href="#configuring-certificates">Configuring Certificates</a>
<ul class="sectlevel2">
<li><a href="#master">Master</a></li>
<li><a href="#registry">Registry</a></li>
<li><a href="#serving-self-signed-certificate-for-docker-clients">Serving self-signed certificate for docker clients</a></li>
</ul>
</li>
<li><a href="#other-configuration-topics">Other Configuration Topics</a>
<ul class="sectlevel2">
<li><a href="#changing-the-session-token-length">Changing the Session Token length</a></li>
<li><a href="#using-service-account-tokens-for-authentication">Using Service Account Tokens for Authentication</a></li>
</ul>
</li>
<li><a href="#data-persistence-and-backup">Data Persistence and Backup</a></li>
<li><a href="#cli">CLI</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="explore-the-environment"><a class="anchor" href="#explore-the-environment"></a>Explore the Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Atomic Registry deploys container services managed by systemd.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo systemctl list-unit-files | grep atomic-registry
atomic-registry-console.service                             enabled
atomic-registry-master.service                              enabled
atomic-registry.service                                     enabled
$ sudo docker ps --format '{{ .Names }}'
atomic-registry-master
atomic-registry
atomic-registry-console</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="logging"><a class="anchor" href="#logging"></a>Logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each container service sends logs to the system journal because they are managed
by systemd. For example, here we follow the log from the <strong>atomic-registry-master</strong>
service unit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo journalctl -flu atomic-registry-master</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Changes to configuration files require a service restart. Under systemd, use <code>systemctl</code>
to manage container lifecycle. Here we restart the atomic-registry-master service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo systemctl restart atomic-registry-master.service</pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="index.html#service-components">three services</a> may be restarted
independently.</p>
</div>
<div class="sect2">
<h3 id="master-configuration"><a class="anchor" href="#master-configuration"></a>Master Configuration</h3>
<div class="paragraph">
<p>Authentication configuration, project defaults, datastore, API certificates and
other settings are defined globally in a configuration file mounted on the host
at <strong><em>/etc/atomic-registry/master/master-config.yaml</em></strong>. Whenever this file is
updated restart the <strong>atomic-registry-master</strong> service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo systemctl restart atomic-registry-master.service</pre>
</div>
</div>
<div class="paragraph">
<p>Global configuration items managed by this configuration file include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../../install_config/configuring_authentication.html#install-config-configuring-authentication">Configure authentication</a>
by integrating with an identity provider</p>
</li>
<li>
<p>Manage <a href="../../admin_guide/managing_projects.html#admin-guide-managing-projects">project namespace self-provisioning</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Master log level is determined using the service unit configuration file mounted
on the host at <strong><em>/etc/sysconfig/atomic-registry-master</em></strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="registry-console-configuration"><a class="anchor" href="#registry-console-configuration"></a>Registry Console Configuration</h3>
<div class="paragraph">
<p>The registry console is a stateless service that has limited configuration using
environment variables defined in a file mounted on the host at
<strong><em>/etc/sysconfig/atomic-registry-console</em></strong>.</p>
</div>
<div class="paragraph">
<p>Configuration changes require a service restart.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo systemctl restart atomic-registry-console.service</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="registry-configuration"><a class="anchor" href="#registry-configuration"></a>Registry Configuration</h3>
<div class="paragraph">
<p>The docker distribution registry configuration is managed by a file mounted on
the host at <strong><em>/etc/atomic-registry/registry/config.yml</em></strong>. See
<a href="#registry-configuration-reference-sysconfig">registry configuration reference</a> for complete settings.</p>
</div>
<div class="paragraph">
<p>Environment variables for this service are managed by a file mounted on the host
at <strong><em>/etc/sysconfig/atomic-registry</em></strong>.</p>
</div>
<div class="paragraph">
<p>Configuration changes require a service restart.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo systemctl restart atomic-registry.service</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-configuration-reference"><a class="anchor" href="#registry-configuration-reference"></a>Registry Configuration Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many configuration options available in the upstream
<a href="https://github.com/docker/distribution">docker distribution</a> library. Not
all <a href="https://docs.docker.com/registry/configuration/">configuration options</a>
are supported or enabled. Use this section as a reference when
<a href="#advanced-overriding-the-registry-configuration">overriding the registry
configuration</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Upstream configuration options in this file may also be overridden using
environment variables. However, the
<a href="#docker-registry-configuration-reference-middleware">middleware section</a> may
<strong>not</strong> be overridden using environment variables.
<a href="https://docs.docker.com/registry/configuration/#override-specific-configuration-options">Learn
how to override specific configuration options</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="docker-registry-configuration-reference-log"><a class="anchor" href="#docker-registry-configuration-reference-log"></a>Log</h3>
<div class="paragraph">
<p><a href="https://docs.docker.com/registry/configuration/#log">Upstream options</a> are supported.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">log</span>:
  <span style="color:#606">level</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">debug</span></span>
  <span style="color:#606">formatter</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">text</span></span>
  <span style="color:#606">fields</span>:
    <span style="color:#606">service</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">registry</span></span>
    <span style="color:#606">environment</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">staging</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="docker-registry-configuration-reference-hooks"><a class="anchor" href="#docker-registry-configuration-reference-hooks"></a>Hooks</h3>
<div class="paragraph">
<p>Mail hooks are not supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="docker-registry-configuration-reference-storage"><a class="anchor" href="#docker-registry-configuration-reference-storage"></a>Storage</h3>
<div class="paragraph">
<p>This section lists the supported <a href="https://docs.docker.com/registry/configuration/#storage">registry storage drivers</a>.</p>
</div>
<div class="paragraph">
<p>The following list includes storage drivers that need to be configured in the
registry&#8217;s configuration file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.docker.com/registry/storage-drivers/filesystem">Filesystem</a>. Filesystem is the default and does not need to be configured.</p>
</li>
<li>
<p><a href="https://docs.docker.com/registry/storage-drivers/s3/">S3</a>. Learn more about <a href="https://github.com/docker/docker.github.io/blob/master/registry/storage-drivers/s3.md#cloudfront-as-middleware-with-s3-backend">CloudFront configuration</a>.</p>
</li>
<li>
<p><a href="https://docs.docker.com/registry/storage-drivers/swift/">OpenStack Swift</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/registry/storage-drivers/gcs/">Google Cloud Storage (GCS)</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/registry/storage-drivers/azure/">Microsoft Azure</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/registry/storage-drivers/oss/">Aliyun OSS</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://docs.docker.com/registry/configuration/#maintenance">General registry storage configuration options</a> are supported.</p>
</div>
<div class="paragraph">
<p>The following storage options need to be configured through the <a href="https://docs.docker.com/registry/storage-drivers/filesystem">filesystem driver</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../../install_config/storage_examples/gluster_backed_registry.html#dedicated-glusterfs-dynamic-example-overview">GlusterFS
Storage</a></p>
</li>
<li>
<p><a href="../../install_config/persistent_storage/persistent_storage_ceph_rbd.html#install-config-persistent-storage-persistent-storage-ceph-rbd">Ceph
Rados Block Device</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information on supported persistent storage drivers, see <a href="../../install_config/persistent_storage/index.html#install-config-persistent-storage-persistent-storage-ceph-rbd">Configuring Persistent Storage</a> and <a href="../../install_config/storage_examples/index.html#install-config-storage-examples-index">Persistent Storage Examples</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">General Storage Configuration Options</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">storage</span>:
  <span style="color:#606">delete</span>:
    <span style="color:#606">enabled</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true </span></span><i class="conum" data-value="1"></i><b>(1)</b>
  <span style="color:#606">redirect</span>:
    <span style="color:#606">disable</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
  <span style="color:#606">cache</span>:
    <span style="color:#606">blobdescriptor</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">inmemory</span></span>
  <span style="color:#606">maintenance</span>:
    <span style="color:#606">uploadpurging</span>:
      <span style="color:#606">enabled</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
      <span style="color:#606">age</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">168h</span></span>
      <span style="color:#606">interval</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">24h</span></span>
      <span style="color:#606">dryrun</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
    <span style="color:#606">readonly</span>:
      <span style="color:#606">enabled</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This entry is <strong>mandatory</strong> for image pruning to work properly.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="docker-registry-configuration-reference-auth"><a class="anchor" href="#docker-registry-configuration-reference-auth"></a>Auth</h3>
<div class="paragraph">
<p>Auth options should not be altered. The <strong>openshift</strong> extension is the only
supported option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">auth</span>:
  <span style="color:#606">openshift</span>:
    <span style="color:#606">realm</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">openshift</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="docker-registry-configuration-reference-middleware"><a class="anchor" href="#docker-registry-configuration-reference-middleware"></a>Middleware</h3>
<div class="paragraph">
<p>The <strong>repository</strong> middleware extension allows to configure Atomic Registry
middleware responsible for interaction with Atomic Registry and image proxying.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">middleware</span>:
  <span style="color:#606">registry</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: openshift </span></span><i class="conum" data-value="1"></i><b>(1)</b>
  <span style="color:#606">repository</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: openshift </span></span><i class="conum" data-value="1"></i><b>(1)</b>
      <span style="color:#606">options</span>:
        <span style="color:#606">acceptschema2</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true </span></span><i class="conum" data-value="2"></i><b>(2)</b>
        <span style="color:#606">pullthrough</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true </span></span><i class="conum" data-value="3"></i><b>(3)</b>
        <span style="color:#606">mirrorpullthrough</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true </span></span><i class="conum" data-value="4"></i><b>(4)</b>
        <span style="color:#606">enforcequota</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false </span></span><i class="conum" data-value="5"></i><b>(5)</b>
        <span style="color:#606">projectcachettl</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1m </span></span><i class="conum" data-value="6"></i><b>(6)</b>
        <span style="color:#606">blobrepositorycachettl</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">10m </span></span><i class="conum" data-value="7"></i><b>(7)</b>
  <span style="color:#606">storage</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: openshift </span></span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>These entries are mandatory. Their presence ensures required components are
loaded. These values should not be changed.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Allows you to store
<a href="https://github.com/docker/distribution/blob/master/docs/spec/manifest-v2-2.md#image-manifest-version-2-schema-2">manifest
schema v2</a> during a push to the registry. See
<a href="#middleware-repository-acceptschema2">below</a> for more details.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Allows the registry to act as a proxy for remote blobs. See
<a href="#middleware-repository-pullthrough">below</a> for more details.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Allows the registry cache blobs to be served from remote registries for fast
access later. The mirroring starts when the blob is accessed for the first time.
The option has no effect if the
<a href="#middleware-repository-pullthrough">pullthrough</a> is disabled.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Prevents blob uploads exceeding the size limit, which are defined in the
targeted project.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>An expiration timeout for limits cached in the registry. The lower the
value, the less time it takes for the limit changes to propagate to the
registry. However, the registry will query limits from the server more
frequently and, as a consequence, pushes will be slower.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>An expiration timeout for remembered associations between blob and
repository. The higher the value, the higher probability of fast lookup and
more efficient registry operation. On the other hand, memory usage will raise
as well as a risk of serving image layer to user, who is no longer authorized
to access it.</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="middleware-cloudfront"><a class="anchor" href="#middleware-cloudfront"></a>CloudFront Middleware</h4>
<div class="paragraph">
<p>The <a href="https://docs.docker.com/registry/configuration/#cloudfront"><strong>CloudFront</strong>
middleware extension</a> can be added to support AWS, CloudFront CDN storage
provider. CloudFront middleware speeds up distribution of image content
internationally. The blobs are distributed to several edge locations around the
world. The client is always directed to the edge with the lowest latency.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="https://docs.docker.com/registry/configuration/#cloudfront"><strong>CloudFront</strong>
middleware extension</a> can be only used with
<a href="https://docs.docker.com/registry/storage-drivers/s3/">S3</a> storage.
It is utilized only during blob serving. Therefore, only blob downloads can be
speeded up, not uploads.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is an example of minimal configuration of S3 storage driver with a
CloudFront middleware:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">version</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">0.1</span></span>
<span style="color:#606">log</span>:
  <span style="color:#606">level</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">debug</span></span>
<span style="color:#606">http</span>:
  <span style="color:#606">addr</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">:5000</span></span>
<span style="color:#606">storage</span>:
  <span style="color:#606">cache</span>:
    <span style="color:#606">blobdescriptor</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">inmemory</span></span>
  <span style="color:#606">delete</span>:
    <span style="color:#606">enabled</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
  <span style="color:#606">s3</span>: <i class="conum" data-value="1"></i><b>(1)</b>
    <span style="color:#606">accesskey</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">BJKMSZBRESWJQXRWMAEQ</span></span>
    <span style="color:#606">secretkey</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">5ah5I91SNXbeoUXXDasFtadRqOdy62JzlnOW1goS</span></span>
    <span style="color:#606">region</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">us-east-1</span></span>
    <span style="color:#606">bucket</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">docker.myregistry.com</span></span>
<span style="color:#606">auth</span>:
  <span style="color:#606">openshift</span>:
    <span style="color:#606">realm</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">openshift</span></span>
<span style="color:#606">middleware</span>:
  <span style="color:#606">registry</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: openshift</span></span>
  <span style="color:#606">repository</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: openshift</span></span>
   <span style="color:#606">storage</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: cloudfront </span></span><i class="conum" data-value="2"></i><b>(2)</b>
      <span style="color:#606">options</span>:
        <span style="color:#606">baseurl</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">https://jrpbyn0k5k88bi.cloudfront.net/ </span></span><i class="conum" data-value="3"></i><b>(3)</b>
        <span style="color:#606">privatekey</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">/etc/docker/cloudfront-ABCEDFGHIJKLMNOPQRST.pem </span></span><i class="conum" data-value="4"></i><b>(4)</b>
        <span style="color:#606">keypairid</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">ABCEDFGHIJKLMNOPQRST </span></span><i class="conum" data-value="5"></i><b>(5)</b>
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: openshift</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The S3 storage must be configured the same way regardless of CloudFront
middleware.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The CloudFront storage middleware needs to be listed before OpenShift
middleware.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The CloudFront base URL. In the AWS management console, this is listed as
<strong>Domain Name</strong> of CloudFront distribution.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The location of your AWS private key on the filesystem. This must be not
confused with Amazon EC2 key pair. Please refer to
<a href="http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-trusted-signers.html#private-content-creating-cloudfront-key-pairs">AWS
documentation</a> on creating CloudFront key pairs for your trusted signers. The
file needs to be mounted as a secret
<a href="../../dev_guide/secrets.html#dev-guide-secrets">secret</a> into the registry
pod.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The ID of your Cloudfront key pair.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="middleware-overriding"><a class="anchor" href="#middleware-overriding"></a>Overriding Middleware Configuration Options</h4>
<div class="paragraph">
<p>The <strong>middleware</strong> section cannot be overridden using environment variables.
There are a few exceptions, however. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">middleware</span>:
  <span style="color:#606">repository</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: openshift</span></span>
      <span style="color:#606">options</span>:
        <span style="color:#606">acceptschema2</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true </span></span><i class="conum" data-value="1"></i><b>(1)</b>
        <span style="color:#606">pullthrough</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true </span></span><i class="conum" data-value="2"></i><b>(2)</b>
        <span style="color:#606">mirrorpullthrough</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true </span></span><i class="conum" data-value="3"></i><b>(3)</b>
        <span style="color:#606">enforcequota</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false </span></span><i class="conum" data-value="4"></i><b>(4)</b>
        <span style="color:#606">projectcachettl</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1m </span></span><i class="conum" data-value="5"></i><b>(5)</b>
        <span style="color:#606">blobrepositorycachettl</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">10m </span></span><i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A configuration option that can be overridden by the boolean environment
variable <code>REGISTRY_MIDDLEWARE_REPOSITORY_OPENSHIFT_ACCEPTSCHEMA2</code>, which
allows for the ability to accept manifest schema v2 on manifest put requests.
Recognized values are <code>true</code> and <code>false</code> (which applies to all the other
boolean variables below).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A configuration option that can be overridden by the boolean environment
variable <code>REGISTRY_MIDDLEWARE_REPOSITORY_OPENSHIFT_PULLTHROUGH</code>, which
enables a proxy mode for remote repositories.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A configuration option that can be overridden by the boolean environment
variable <code>REGISTRY_MIDDLEWARE_REPOSITORY_OPENSHIFT_MIRRORPULLTHROUGH</code>, which
instructs registry to mirror blobs locally if serving remote blobs.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A configuration option that can be overridden by the boolean environment
variable <code>REGISTRY_MIDDLEWARE_REPOSITORY_OPENSHIFT_ENFORCEQUOTA</code>, which
allows the ability to turn quota enforcement on or off. By default, quota
enforcement is off.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>A configuration option that can be overridden by the environment variable
<code>REGISTRY_MIDDLEWARE_REPOSITORY_OPENSHIFT_PROJECTCACHETTL</code>, specifying an
eviction timeout for project quota objects. It takes a valid time duration
string (for example, <code>2m</code>). If empty, you get the default timeout. If zero
(<code>0m</code>), caching is disabled.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>A configuration option that can be overriden by the environment variable
<code>REGISTRY_MIDDLEWARE_REPOSITORY_OPENSHIFT_BLOBREPOSITORYCACHETTL</code>, specifying
an eviction timeout for associations between blob and containing repository.
The format of the value is the same as in <code>projectcachettl</code> case.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="middleware-repository-pullthrough"><a class="anchor" href="#middleware-repository-pullthrough"></a>Image Pullthrough</h4>
<div class="paragraph">
<p>If enabled, the registry will attempt to fetch requested blob from a remote
registry unless the blob exists locally. The remote candidates are calculated
from <strong>DockerImage</strong> entries stored in status of the
<a href="../../architecture/core_concepts/builds_and_image_streams.html#image-streams">image
stream</a>, a client pulls from. All the unique remote registry references in
such entries will be tried in turn until the blob is found. The blob, served
this way, will not be stored in the registry.</p>
</div>
<div class="paragraph">
<p>This feature is on by default. However, it can be disabled using a
<a href="#docker-registry-configuration-reference-middleware">configuration option</a>.</p>
</div>
<div class="paragraph">
<p>By default, all the remote blobs served this way are stored locally for
subsequent faster access unless <code>mirrorpullthrough</code> is disabled. The downside
of this mirroring feature is an increased storage usage.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The mirroring starts when a client tries to fetch at least a single byte of the
blob. To pre-fetch a particular image into integrated registry before it is
actually needed, you can run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get imagestreamtag/${IS}:${TAG} -o jsonpath='{ .image.dockerImageLayers[*].name }' | \
  xargs -n1 -I {} curl -H "Range: bytes=0-1" -u user:${TOKEN} \
  http://${REGISTRY_IP}:${PORT}/v2/default/mysql/blobs/{}</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="middleware-repository-acceptschema2"><a class="anchor" href="#middleware-repository-acceptschema2"></a>Manifest Schema v2 Support</h4>
<div class="paragraph">
<p>Each image has a manifest describing its blobs, instructions for running it
and additional metadata. The manifest is versioned which have different
structure and fields as it evolves over time. The same image can be represented
by multiple manifest versions. Each version will have different digest though.</p>
</div>
<div class="paragraph">
<p>The registry currently supports
<a href="https://github.com/docker/distribution/blob/master/docs/spec/manifest-v2-1.md#image-manifest-version-2-schema-1">manifest
v2 schema 1</a> (<strong>schema1</strong>) and
<a href="https://github.com/docker/distribution/blob/master/docs/spec/manifest-v2-2.md#image-manifest-version-2-schema-2">manifest
v2 schema 2</a> (<strong>schema2</strong>). The former is being obsoleted but will be supported
for an extended amount of time.</p>
</div>
<div class="paragraph">
<p>You should be wary of compatibility issues with various Docker clients:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Docker clients of version 1.9 or older support only <strong>schema1</strong>. Any manifest
this client pulls or pushes will be of this legacy schema.</p>
</li>
<li>
<p>Docker clients of version 1.10 support both <strong>schema1</strong> and <strong>schema2</strong>. And by default, it will
push the latter to the registry if it supports newer schema.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The registry, storing an image with <strong>schema1</strong> will always return it unchanged
to the client. <strong>Schema2</strong> will be transferred unchanged only to newer Docker
client. For the older one, it will be converted on-the-fly to <strong>schema1</strong>.</p>
</div>
<div class="paragraph">
<p>This has significant consequences. For example an image pushed to the registry
by a newer Docker client cannot be pulled by the older Docker by its digest.
That&#8217;s because the stored image&#8217;s manifest is of <strong>schema2</strong> and its digest can
be used to pull only this version of manifest.</p>
</div>
<div class="paragraph">
<p>For this reason, the registry is configured by default not to store <strong>schema2</strong>.
This ensures that any docker client will be able to pull from the registry any
image pushed there regardless of client&#8217;s version.</p>
</div>
<div class="paragraph">
<p>Once you&#8217;re confident that all the registry clients support <strong>schema2</strong>, you&#8217;ll
be safe to enable its support in the registry. See the
<a href="#docker-registry-configuration-reference-middleware">middleware
configuration reference</a> above for particular option.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="docker-registry-configuration-reference-openshift"><a class="anchor" href="#docker-registry-configuration-reference-openshift"></a>OpenShift</h3>
<div class="paragraph">
<p>This section reviews the configuration of global settings related to
Atomic Registry specific features. In the future, <code>openshift</code>-related settings
in the <a href="#docker-registry-configuration-reference-middleware">middleware
section</a> will be obsolete. Currently, this section allows you to configure only
for metrics collection.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">openshift:
  version: 1.0 <i class="conum" data-value="1"></i><b>(1)</b>
  metrics:
    enabled: false <i class="conum" data-value="2"></i><b>(2)</b>
    secret: PUT_YOUR_SECRET_HERE <i class="conum" data-value="3"></i><b>(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A mandatory entry specifying configuration version of this section. The
only supported value is <code>1.0</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Can be set to <code>true</code> to enable metrics collection. The same can be
achieved using the boolean environment variable
<code>REGISTRY_OPENSHIFT_METRICS_ENABLED=true</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A secret used to authorize client requests. Metrics clients must use it as
a bearer token in <code>Authorization</code> header. It can be overridden by the
environment variable <code>REGISTRY_OPENSHIFT_METRICS_SECRET</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Refer to <a href="accessing_registry.html#accessing-metrics">accessing metrics</a> for
usage information.</p>
</div>
</div>
<div class="sect2">
<h3 id="docker-registry-configuration-reference-reporting"><a class="anchor" href="#docker-registry-configuration-reference-reporting"></a>Reporting</h3>
<div class="paragraph">
<p>Reporting is unsupported.</p>
</div>
</div>
<div class="sect2">
<h3 id="docker-registry-configuration-reference-http"><a class="anchor" href="#docker-registry-configuration-reference-http"></a>HTTP</h3>
<div class="paragraph">
<p><a href="https://docs.docker.com/registry/configuration/#http">Upstream options</a> are
supported. <a href="#securing-the-registry">Learn how to alter these settings via
environment variables</a>. Only the <strong>tls</strong> section should be altered. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">http</span>:
  <span style="color:#606">addr</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">:5000</span></span>
  <span style="color:#606">tls</span>:
    <span style="color:#606">certificate</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">/etc/secrets/registry.crt</span></span>
    <span style="color:#606">key</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">/etc/secrets/registry.key</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="docker-registry-configuration-reference-notifications"><a class="anchor" href="#docker-registry-configuration-reference-notifications"></a>Notifications</h3>
<div class="paragraph">
<p><a href="https://docs.docker.com/registry/configuration/#notifications">Upstream
options</a> are supported. The <a href="../../rest_api/index.html#rest-api-index">REST API Reference</a>
provides more comprehensive integration options.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">notifications</span>:
  <span style="color:#606">endpoints</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: registry</span></span>
      <span style="color:#606">disabled</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
      <span style="color:#606">url</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">https://url:port/path</span></span>
      <span style="color:#606">headers</span>:
        <span style="color:#606">Accept</span>:
          - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">text/plain</span></span>
      <span style="color:#606">timeout</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">500</span></span>
      <span style="color:#606">threshold</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">5</span></span>
      <span style="color:#606">backoff</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1000</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="docker-registry-configuration-reference-redis"><a class="anchor" href="#docker-registry-configuration-reference-redis"></a>Redis</h3>
<div class="paragraph">
<p>Redis is not supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="docker-registry-configuration-reference-health"><a class="anchor" href="#docker-registry-configuration-reference-health"></a>Health</h3>
<div class="paragraph">
<p><a href="https://docs.docker.com/registry/configuration/#health">Upstream options</a>
are supported. The registry deployment configuration provides an integrated
health check at <strong>/healthz</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="docker-registry-configuration-reference-proxy"><a class="anchor" href="#docker-registry-configuration-reference-proxy"></a>Proxy</h3>
<div class="paragraph">
<p>Proxy configuration should not be enabled. This functionality is provided by
the <a href="#docker-registry-configuration-reference-middleware">Atomic Registry
repository middleware extension</a>, <strong>pullthrough: true</strong>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-certificates"><a class="anchor" href="#configuring-certificates"></a>Configuring Certificates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The service endpoints are secured by certificates that are mounted on the host at
<strong><em>/etc/atomic-registry/</em></strong>. There are separate directories for master and registry certificates.</p>
</div>
<div class="sect2">
<h3 id="master"><a class="anchor" href="#master"></a>Master</h3>
<div class="paragraph">
<p>The installer generates self-signed certificates during installation. See
<a href="../../install_config/certificate_customization.html#install-config-certificate-customization">certificate customization</a>
for customizing the API master certificates.</p>
</div>
</div>
<div class="sect2">
<h3 id="registry"><a class="anchor" href="#registry"></a>Registry</h3>
<div class="paragraph">
<p>Here we create a self-signed certificate so docker clients can connect using
TLS. While other tools like openssl may be used to create certificates, the
master API provides a tool that may also be used.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Exec into the atomic-registry-master container to access the CLI and change directory</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo docker exec -it atomic-registry-master bash
$ cd /etc/atomic-registry/master</pre>
</div>
</div>
</li>
<li>
<p>Use the administrator CLI to generate self-signed certificates and exit the
container.</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oadm ca create-server-cert \
  --signer-cert=ca.crt \
  --signer-key=ca.key \
  --signer-serial=ca.serial.txt \
  --hostnames='&lt;hostname(s)&gt;' \
  --cert=registry.crt \
  --key=registry.key
$ exit</pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>oadm ca create-server-cert</code> command generates a certificate that is valid
for two years. This can be altered with the <code>--expire-days</code> option, but for
security reasons, it is recommended to not make it greater than this value.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Copy the generated files to the registry directory and change ownership so the
atomic-registry service can read the files.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo cp /etc/atomic-registry/master/registry.* /etc/atomic-registry/registry/
$ sudo chown -R 1001:root /etc/atomic-registry/registry/</pre>
</div>
</div>
</li>
<li>
<p>Edit file <strong>/etc/sysconfig/atomic-registry</strong> and uncomment environment
variables <code>REGISTRY_HTTP_TLS_CERTIFICATE</code> and <code>REGISTRY_HTTP_TLS_KEY</code>.</p>
</li>
<li>
<p>Restart the <strong>atomic-registry</strong> service to load the configuration changes.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo systemctl restart atomic-registry.service</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="serving-self-signed-certificate-for-docker-clients"><a class="anchor" href="#serving-self-signed-certificate-for-docker-clients"></a>Serving self-signed certificate for docker clients</h3>
<div class="paragraph">
<p>If you secure the registry using a self-signed certificate key pair you may want
to make the public CA certificate available to users so they don&#8217;t have to put
docker into insecure mode. The registry master service is able to serve
arbitrary files.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit file <strong><em>/etc/atomic-registry/master/master-config.yaml</em></strong> and add the
following extension.</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">    assetConfig:
      ...
      extensions:
        - name: certs
          sourceDirectory: /etc/atomic-registry/master/site</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Copy the certificate to the site subdirectory.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo cp /etc/atomic-registry/master/ca.crt /etc/atomic-registry/master/site/</pre>
</div>
</div>
</li>
<li>
<p>Restart the atomic-registry-master service to load the configuration changes.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo systemctl restart atomic-registry-master.service</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Registry users may then be instructed to save this cert into their docker client
and restart their docker daemon.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl --insecure -O https://&lt;registry_hostname&gt;:8443/console/extensions/certs/ca.crt
$ sudo cp ca.crt /etc/docker/certs.d/&lt;registry_hostname&gt;:5000/.
$ sudo systemctl restart docker.service</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="other-configuration-topics"><a class="anchor" href="#other-configuration-topics"></a>Other Configuration Topics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="changing-the-session-token-length"><a class="anchor" href="#changing-the-session-token-length"></a>Changing the Session Token length</h3>
<div class="paragraph">
<p>By default the session token used for <code>docker login</code> is 24 hours. This
requires users to run <code>docker login</code> every day. This value may be extended in
the master configuration file <strong><em>/etc/atomic-registry/master/master-config.yaml</em></strong>.
See <a href="#using-service-account-tokens-for-authentication">below</a> for using
long-lived service account tokens.</p>
</div>
<div class="paragraph">
<p>In this example the session token expiration is extended to 30 days.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">tokenConfig:
  accessTokenMaxAgeSeconds: 2592000</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Restart the atomic-registry-master service to update the running configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo systemctl restart atomic-registry-master.service</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-service-account-tokens-for-authentication"><a class="anchor" href="#using-service-account-tokens-for-authentication"></a>Using Service Account Tokens for Authentication</h3>
<div class="paragraph">
<p>Typically long-lived, token-based authentication is desired. As an alternative
to using user session tokens that expire, users may use
<a href="../../admin_guide/service_accounts.html#admin-guide-service-accounts">service account tokens</a> to
authenticate with docker. This is particularly useful when integrating automation.
See the
<a href="../developers.html#using-service-account-tokens-for-docker-login">quickstart developer guide</a>
for instructions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-persistence-and-backup"><a class="anchor" href="#data-persistence-and-backup"></a>Data Persistence and Backup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The data that should be persisted is the configuration, image data and the
master database. The required directories are mounted from the container onto
the host. See <a href="index.html#service-components">Service Components table</a> for
specific paths.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cli"><a class="anchor" href="#cli"></a>CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Atomic Registry provides full control using a command line interface (CLI). To
access the CLI directly on the host you may enter the <strong>atomic-registry-master</strong>
container.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo docker exec -it atomic-registry-master bash
# oc whoami
system:admin
# oc projects
Using project "default" on server "https://localhost:8443".</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="../../cli_reference/index.html#cli-reference-index">CLI reference</a> for how to download the
remote CLI client and using the CLI.</p>
</div>
</div>
</div>
  </div>

  <div class='col-sm-3 hidden-print'>
    <h2>Atomic Registry</h2>
    <nav role='navigation'>
      <ul class='docbrowser nav nav-vertical'>
        <li class='disabled'>
          <h3>Quickstart</h3>
        </li>
              <li role="menuitem" class=""><a href="../../registry_quickstart/index.html">Overview</a></li>
              <li role="menuitem" class=""><a href="../../registry_quickstart/developers.html">Developers</a></li>
            <!-- <li role="menuitem"><a>Administrators</a></li> -->
            <li role="menuitem" class="">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-2">
                <span id="sgSpan-0-2" class="fa fa-caret-down"></span>&nbsp;Administrators
              </a>
              <ul id="topicSubGroup-0-2" class="nav-tertiary list-unstyled collapse in">

                  <li class="">&nbsp;<a role="menuitem" href="../../registry_quickstart/administrators/index.html">Overview</strong></a><li>

                  <li class=" active">&nbsp;<a role="menuitem" href="../../registry_quickstart/administrators/system_configuration.html">System Configuration</strong></a><li>

                  <li class="">&nbsp;<a role="menuitem" href="../../registry_quickstart/administrators/uninstall.html">Uninstall</strong></a><li>
              </ul>
            </li>
        <li class='disabled'>
          <h3>Architecture</h3>
        </li>
              <li role="menuitem" class=""><a href="../../architecture/index.html">Overview</a></li>
            <!-- <li role="menuitem"><a>Infrastructure Components</a></li> -->
            <li role="menuitem" class="">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-1-1">
                <span id="sgSpan-1-1" class="fa fa-caret-right"></span>&nbsp;Infrastructure Components
              </a>
              <ul id="topicSubGroup-1-1" class="nav-tertiary list-unstyled collapse">

                  <li class="">&nbsp;<a role="menuitem" href="../../architecture/infrastructure_components/kubernetes_infrastructure.html">Kubernetes Infrastructure</strong></a><li>

                  <li class="">&nbsp;<a role="menuitem" href="../../architecture/infrastructure_components/image_registry.html">Container Registry</strong></a><li>

                  <li class="">&nbsp;<a role="menuitem" href="../../architecture/infrastructure_components/web_console.html">Web Console</strong></a><li>
              </ul>
            </li>
            <!-- <li role="menuitem"><a>Core Concepts</a></li> -->
            <li role="menuitem" class="">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-1-2">
                <span id="sgSpan-1-2" class="fa fa-caret-right"></span>&nbsp;Core Concepts
              </a>
              <ul id="topicSubGroup-1-2" class="nav-tertiary list-unstyled collapse">

                  <li class="">&nbsp;<a role="menuitem" href="../../architecture/core_concepts/containers_and_images.html">Images</strong></a><li>

                  <li class="">&nbsp;<a role="menuitem" href="../../architecture/core_concepts/projects_and_users.html">Projects and Users</strong></a><li>

                  <li class="">&nbsp;<a role="menuitem" href="../../architecture/core_concepts/builds_and_image_streams.html">Image Streams</strong></a><li>

                  <li class="">&nbsp;<a role="menuitem" href="../../architecture/core_concepts/routes.html">Routes</strong></a><li>
              </ul>
            </li>
            <!-- <li role="menuitem"><a>Additional Concepts</a></li> -->
            <li role="menuitem" class="">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-1-3">
                <span id="sgSpan-1-3" class="fa fa-caret-right"></span>&nbsp;Additional Concepts
              </a>
              <ul id="topicSubGroup-1-3" class="nav-tertiary list-unstyled collapse">

                  <li class="">&nbsp;<a role="menuitem" href="../../architecture/additional_concepts/authentication.html">Authentication</strong></a><li>

                  <li class="">&nbsp;<a role="menuitem" href="../../architecture/additional_concepts/authorization.html">Authorization</strong></a><li>

                  <li class="">&nbsp;<a role="menuitem" href="../../architecture/additional_concepts/other_api_objects.html">Other API Objects</strong></a><li>
              </ul>
            </li>
        <li class='disabled'>
          <h3>Installation and Configuration</h3>
        </li>
              <li role="menuitem" class=""><a href="../../install_config/adding_hosts_to_existing_cluster.html">Adding Hosts to an Existing Cluster</a></li>
              <li role="menuitem" class=""><a href="../../install_config/certificate_customization.html">Configuring Custom Certificates</a></li>
              <li role="menuitem" class=""><a href="../../install_config/redeploying_certificates.html">Redeploying Certificates</a></li>
              <li role="menuitem" class=""><a href="../../install_config/configuring_authentication.html">Configuring Authentication and User Agent</a></li>
              <li role="menuitem" class=""><a href="../../install_config/syncing_groups_with_ldap.html">Syncing Groups With LDAP</a></li>
            <!-- <li role="menuitem"><a>Advanced LDAP Configuration</a></li> -->
            <li role="menuitem" class="">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-2-5">
                <span id="sgSpan-2-5" class="fa fa-caret-right"></span>&nbsp;Advanced LDAP Configuration
              </a>
              <ul id="topicSubGroup-2-5" class="nav-tertiary list-unstyled collapse">

                  <li class="">&nbsp;<a role="menuitem" href="../../install_config/advanced_ldap_configuration/index.html">Overview</strong></a><li>

                  <li class="">&nbsp;<a role="menuitem" href="../../install_config/advanced_ldap_configuration/sssd_for_ldap_failover.html">Setting up SSSD for LDAP Failover</strong></a><li>

                  <li class="">&nbsp;<a role="menuitem" href="../../install_config/advanced_ldap_configuration/configuring_form_based_authentication.html">Configuring Form-Based Authentication</strong></a><li>

                  <li class="">&nbsp;<a role="menuitem" href="../../install_config/advanced_ldap_configuration/configuring_extended_ldap_attributes.html">Configuring Extended LDAP Attributes</strong></a><li>
              </ul>
            </li>
              <li role="menuitem" class=""><a href="../../install_config/web_console_customization.html">Customizing the Web Console</a></li>
        <li class='disabled'>
          <h3>Cluster Administration</h3>
        </li>
              <li role="menuitem" class=""><a href="../../admin_guide/index.html">Overview</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/manage_users.html">Managing Users</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/managing_projects.html">Managing Projects</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/managing_pods.html">Managing Pods</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/managing_networking.html">Managing Networking</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/service_accounts.html">Configuring Service Accounts</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/manage_authorization_policy.html">Managing Authorization Policies</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/image_policy.html">Image Policy</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/scoped_tokens.html">Scoped Tokens</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/quota.html">Setting Quotas</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/multiproject_quota.html">Setting Multi-Project Quotas</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/limits.html">Setting Limit Ranges</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/allocating_node_resources.html">Allocating Node Resources</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/tcp_ingress_external_ports.html">Assigning Unique External IPs for Ingress Traffic</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/seccomp.html">Restricting Application Capabilities Using Seccomp</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/backup_restore.html">Backup and Restore</a></li>
              <li role="menuitem" class=""><a href="../../admin_guide/idling_applications.html">Idling Applications</a></li>
        <li class='disabled'>
          <h3>User Guide</h3>
        </li>
              <li role="menuitem" class=""><a href="../../dev_guide/index.html">Overview</a></li>
              <li role="menuitem" class=""><a href="../../dev_guide/authentication.html">Authentication</a></li>
              <li role="menuitem" class=""><a href="../../dev_guide/managing_images.html">Managing Images</a></li>
              <li role="menuitem" class=""><a href="../../dev_guide/service_accounts.html">Service Accounts</a></li>
        <li class='disabled'>
          <h3>CLI Reference</h3>
        </li>
              <li role="menuitem" class=""><a href="../../cli_reference/index.html">Overview</a></li>
              <li role="menuitem" class=""><a href="../../cli_reference/get_started_cli.html">Get Started with the CLI</a></li>
              <li role="menuitem" class=""><a href="../../cli_reference/manage_cli_profiles.html">Managing CLI Profiles</a></li>
        <li class='disabled'>
          <h3>REST API Reference</h3>
        </li>
              <li role="menuitem" class=""><a href="../../rest_api/index.html">Overview</a></li>
              <li role="menuitem" class=""><a href="../../rest_api/openshift_v1.html">OpenShift v1</a></li>
              <li role="menuitem" class=""><a href="../../rest_api/kubernetes_v1.html">Kubernetes v1</a></li>
</ul>
    </nav>
  </div>
</div>
</section>
</div>
<div class='row'>
<div class='col-md-offset-3 col-md-9 col-lg-offset-2 col-lg-10' id='footer'>
  <footer>
<hr class='visible-print'>

&copy; 2014&ndash;2016 Project Atomic. Sponsored by Red Hat, Inc.
<div class='edit-this-page pull-right'>
<a href="https://github.com/openshift/openshift-docs#contributing-to-openshift-documentation"><i class="icon fa fa-fw fa-github"></i>Edit this page on GitHub</a>
</div>
        <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://piwik-osasteam.rhcloud.com/piwik/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 4]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
        g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
<noscript><p><img src="https://piwik-osasteam.rhcloud.com/piwik/piwik.php?idsite=4" style="border:0;" alt="" /></p></noscript>
</footer>
</div>
</div>

</section>

<script src="http://www.projectatomic.io/javascripts/application.js" type="text/javascript"></script>


</body>
</html>